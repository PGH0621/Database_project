<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>{{ movie.movieNm }}</title>

<style>
body { background:#000; color:#fff; font-family:Arial; margin:0; }

.container{
  position:relative;
  display:flex;
  gap:40px;
  padding:60px;
}

.poster { width:300px; border-radius:10px; }
.meta { font-size:14px; opacity:.85; margin-top:6px; }

/* ===== ì°œ ë²„íŠ¼ ===== */
.fav-form{
  position:absolute;
  top:20px;
  right:20px;
}

.fav-btn{
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  transition:.2s;
}
.fav-off{ background:#222; color:#fff; }
.fav-on{ background:#E50914; color:#fff; }

/* ===== ì¬ìƒ ë²„íŠ¼ ===== */
.play-wrap{
  margin-top:24px;
  display:flex;
  gap:12px;
  align-items:center;
}

.play-btn{
  padding:10px 22px;
  font-size:15px;
  border:none;
  border-radius:6px;
}

.play-disabled{
  background:#333;
  color:#777;
  cursor:not-allowed;
}

.play-active{
  background:#E50914;
  color:#fff;
  cursor:pointer;
}

.play-info{
  font-size:13px;
  opacity:.6;
}

/* ===== ëª¨ë‹¬ ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  z-index:1000;
}

.modal-content{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

.close{
  position:absolute;
  top:-40px;
  right:0;
  font-size:32px;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ë©”ì¸ìœ¼ë¡œ -->
<div style="margin:30px 60px;">
  <button onclick="location.href='/'"
          style="background:#111;color:#fff;border:1px solid #333;
                 padding:10px 18px;border-radius:6px;cursor:pointer;">
    â† ë©”ì¸ìœ¼ë¡œ
  </button>
</div>

<div class="container">

  <!-- ì°œ ë²„íŠ¼ -->
  <form method="POST"
        action="/favorite/{{ movie.movieCd }}"
        class="fav-form">
    <button type="submit"
            class="fav-btn {{ 'fav-on' if is_favorite else 'fav-off' }}">
      {{ 'â¤ï¸ ì°œë¨' if is_favorite else 'ğŸ¤ ì°œí•˜ê¸°' }}
    </button>
  </form>

  <img class="poster" src="/static/posters/{{ movie.poster }}">

  <div>
    <h1>{{ movie.movieNm }}</h1>

    {% if info.movieNmEn %}<div class="meta">ì˜ë¬¸ëª…: {{ info.movieNmEn }}</div>{% endif %}
    {% if info.openDt %}<div class="meta">ê°œë´‰ì¼: {{ info.openDt }}</div>{% endif %}
    {% if info.genres %}<div class="meta">ì¥ë¥´: {{ info.genres }}</div>{% endif %}
    {% if info.showTm %}<div class="meta">ìƒì˜ì‹œê°„: {{ info.showTm }}ë¶„</div>{% endif %}
    {% if info.directors %}<div class="meta">ê°ë…: {{ info.directors }}</div>{% endif %}
    {% if info.actors %}<div class="meta">ì¶œì—°: {{ info.actors }}</div>{% endif %}
    {% if info.audits %}<div class="meta">ê´€ëŒë“±ê¸‰: {{ info.audits }}</div>{% endif %}

    <hr style="margin:20px 0; opacity:.3">

    <div class="meta">ëˆ„ì  ê´€ê°ìˆ˜: {{ movie.audiAcc }}</div>
    <div class="meta">ëˆ„ì  ë§¤ì¶œ: {{ movie.salesAcc }}</div>

    <!-- ì¬ìƒ ë²„íŠ¼ ì˜ì—­ -->
    <div class="play-wrap">

  <!-- í•­ìƒ í™œì„± / ì²˜ìŒë¶€í„° ì¬ìƒ -->
  <button class="play-btn play-active"
          onclick="openPlayer(0)">
    â–¶ ì¬ìƒ
  </button>

  {% if has_watch_history %}
    <button class="play-btn play-active"
            onclick="openPlayer({{ watched_sec }})">
      â–¶ ì´ì–´ì„œ ì¬ìƒ
    </button>
    <span style="opacity:.6; font-size:13px;">
      {{ watched_sec|int }}ì´ˆë¶€í„° ì´ì–´ì„œ ì¬ìƒ
    </span>
  {% else %}
    <button class="play-btn play-disabled" disabled>
      â–¶ ì´ì–´ì„œ ì¬ìƒ
    </button>
    <span style="opacity:.6; font-size:13px;">
      ì‹œì²­ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
    </span>
  {% endif %}

</div>
  </div>
</div>

<!-- ë¹„ë””ì˜¤ ëª¨ë‹¬ -->
<div id="videoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closePlayer()">Ã—</span>

    <video id="movieVideo" controls width="800">
      <source src="/static/videos/zoo.mp4" type="video/mp4">
    </video>
  </div>
</div>

<script>
const modal = document.getElementById("videoModal");
const video = document.getElementById("movieVideo");
let saveInterval = null;

function openPlayer(startTime){
  modal.style.display = "block";
  video.currentTime = startTime || 0;
  video.play();
  saveInterval = setInterval(saveWatchTime, 5000);
}

function closePlayer(){
  modal.style.display = "none";
  saveWatchTime();
  video.pause();
  clearInterval(saveInterval);
}

function saveWatchTime(){
  fetch("/watch_time/{{ movie.movieCd }}", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      watched_sec: video.currentTime
    })
  });
}
</script>

</body>
</html>
